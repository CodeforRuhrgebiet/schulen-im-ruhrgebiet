---
layout: base
---

<script src="{{ '/js/lib/L.Control.Locate.min.js' | site.github.url }}"></script>

<style>
  body {
    padding: 0;
    margin: 0;
  }
  html, body, #schoolMap {
    height: 100%;
    width: 100%;
  }
</style>

{% for city in site.cities %}
  {% if page.key == city.key %}
    {% assign meta = city %}
    {% break %}
  {% endif %}
{% endfor %}

<div class="navbar navbar-default navbar-fixed-top map-navbar">
  <a href="{{ site.github.url }}/stadt/{{ meta.key }}/" title="Karte schließen" class="btn btn-white m-r-2">
    <span class="fa fa-times"></span>
  </a>
  <button title="Filter einstellen" type="button" class="btn btn-white" data-toggle="collapse" data-target="#collapseFilter" aria-expanded="false" aria-controls="collapseFilter">
    <span class="fa fa-filter"></span>
  </button>

  <div class="collapse m-t-1" id="collapseFilter">
    <div class="card card-block">
      <h2 class="h4">Filter einstellen</h2>

      <div class="checkbox">
        <label>
          <input type="checkbox" checked>
          Schulbetrieb andeuten<br>
          <small><em>(transparent, wenn nicht in Betrieb)</em></small>
        </label>
      </div>

      <div class="checkbox">
        <label>
          <input type="checkbox" checked>
          Öffentliche Schulen und Privatschulen hervorheben<br>
          <small><em>(privat wird lila, öffentlich grün)</em></small>
        </label>
      </div>
    </div>
  </div>
</div>

<div id="schoolMap"></div>
<script>
  var latitude = 51.4818445, longitude = 7.216236299999991, zoomlevel = 10;
  {% if meta.latitude %} latitude = {{ meta.latitude }}; {% endif %}
  {% if meta.longitude %} longitude = {{ meta.longitude }}; {% endif %}
  {% if meta.zoomlevel %} zoomlevel = {{ meta.zoomlevel }}; {% endif %}

  var schoolMap = L.map('schoolMap', { zoomControl: false }).setView([latitude, longitude], zoomlevel);
  new L.Control.Zoom({ position: 'topright' }).addTo(schoolMap);
  L.control.locate({
    position: 'topright',  // set the location of the control
    strings: {
      title: "Zeige mir wo ich bin",
      metersUnit: "Meter",
      feetUnit: "Fuß",
      popup: "Du bist innerhalb {distance} {unit} von diesem Punkt aus",
      outsideMapBoundsMsg: "Du befindest dich anscheint außerhalb der verfügbaren Karte"
    },
    locateOptions: { maxZoom: 16 }
  }).addTo(schoolMap);


  // improve experience on mobile
  if (schoolMap.tap) schoolMap.tap.disable();

  // adding layers
  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: '<a href="https://www.mapbox.com/about/maps/" target="_blank">&copy; Mapbox &copy; OpenStreetMap</a> | <a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a>',
    id: 'maschurig.p8gbjfbc',
    accessToken: 'pk.eyJ1IjoibWFzY2h1cmlnIiwiYSI6ImNpbDJiajEzejAwY2F3OW0wOG95czR5eXkifQ.igaYJkeB7_dF36mj4N1Jvg'
  }).addTo(schoolMap);


  // adding data
  $.getJSON( "/js/cities/{{ meta.key }}.geojson", function(data) {
    L.geoJson(data, {
      style: function (feature) {
        return feature.properties.style;
      },
      onEachFeature: function (feature, layer) {
        var publicText = '<span class="label label-success">öffentlich</span>';
        var betriebText = '<span class="label label-default">' + feature.properties.schulbetrieb + '</span>';
        var schulformText = '<span class="label label-warning">' + feature.properties.schulform + '</span>';

        layer.bindPopup(
          '<b>' + feature.properties.schulbezeichnung
          + '<br><br>'
          + publicText + ' ' + betriebText
          + '<br><br>'
          + schulformText
          + '<br><br>'
          + 'Träger: ' + feature.properties.schultrager
          + '<br><br>'
        );
      }
    }).addTo(schoolMap);
  });
</script>
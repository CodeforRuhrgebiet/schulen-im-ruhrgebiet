---
layout: base
---

<script src="{{ '/js/lib/L.Control.Locate.min.js' | site.github.url }}"></script>
<script src="{{ '/js/lib/leaflet.awesome-markers.min.js' | site.github.url }}"></script>

<style>
  body {
    padding: 0;
    margin: 0;
  }
  html, body, #schoolMap {
    height: 100%;
    width: 100%;
  }
</style>

{% for city in site.cities %}
  {% if page.key == city.key %}
    {% assign meta = city %}
    {% break %}
  {% endif %}
{% endfor %}

<div class="navbar navbar-default navbar-fixed-top map-navbar">
  <a href="{{ site.github.url }}/stadt/{{ meta.key }}/" title="Karte schließen" class="btn btn-white m-r-2">
    <span class="fa fa-times"><span class="hidden-sm-down"> Schließen</span></span>
  </a>
  <button title="Filter einstellen" type="button" class="btn btn-white" data-toggle="collapse" data-target="#collapseFilter" aria-expanded="false" aria-controls="collapseFilter">
    <span class="fa fa-filter"><span class="hidden-sm-down"> Filter</span></span>
  </button>

  <div class="collapse m-t-1" id="collapseFilter">
    <div class="row">
      <div class="col-xs-11 col-sm-11 col-md-8 col-lg-5">
        <div class="card card-block">
          <h2 class="h4">Filter einstellen</h2>

          <div class="checkbox">
            <label>
              <input type="checkbox" checked>
              Schulbetrieb andeuten<br>
              <small><em>(transparent, wenn nicht in Betrieb)</em></small>
            </label>
          </div>

          <div class="checkbox">
            <label>
              <input type="checkbox" checked>
              Öffentliche Schulen und Privatschulen hervorheben<br>
              <small><em>(privat wird lila, öffentlich grün)</em></small>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="schoolMap"></div>
<script>
  var latitude = 51.4818445, longitude = 7.216236299999991, zoomlevel = 10;
  {% if meta.latitude %} latitude = {{ meta.latitude }}; {% endif %}
  {% if meta.longitude %} longitude = {{ meta.longitude }}; {% endif %}
  {% if meta.zoomlevel %} zoomlevel = {{ meta.zoomlevel }}; {% endif %}

  var schoolMap = L.map('schoolMap', { zoomControl: false }).setView([latitude, longitude], zoomlevel);
  new L.Control.Zoom({ position: 'topright' }).addTo(schoolMap);
  L.control.locate({
    position: 'topright',  // set the location of the control
    strings: {
      title: "Zeige mir wo ich bin",
      metersUnit: "Meter",
      feetUnit: "Fuß",
      popup: "Du bist innerhalb {distance} {unit} von diesem Punkt aus",
      outsideMapBoundsMsg: "Du befindest dich anscheint außerhalb der verfügbaren Karte"
    },
    locateOptions: { maxZoom: 16 }
  }).addTo(schoolMap);


  // improve experience on mobile
  if (schoolMap.tap) schoolMap.tap.disable();

  // adding layers
  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: '<a href="https://www.mapbox.com/about/maps/" target="_blank">&copy; Mapbox &copy; OpenStreetMap</a> | <a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a>',
    id: 'maschurig.p8gbjfbc',
    accessToken: 'pk.eyJ1IjoibWFzY2h1cmlnIiwiYSI6ImNpbDJiajEzejAwY2F3OW0wOG95czR5eXkifQ.igaYJkeB7_dF36mj4N1Jvg'
  }).addTo(schoolMap);

  L.AwesomeMarkers.Icon.prototype.options.prefix = 'fa';
  L.AwesomeMarkers.Icon.prototype.options.extraClasses = 'lalalala';

  var publicSchoolMarker = L.AwesomeMarkers.icon({
    icon: 'circle',
    markerColor: 'blue',
    iconColor: '#fff'
  });

  var privateSchoolMarker = L.AwesomeMarkers.icon({
    icon: 'circle',
    markerColor: 'purple',
    iconColor: '#fff'
  });

//  var schoolMarker = L.icon({
//    iconUrl: '/img/markers/map-pin.svg',
//    iconSize: [40, 40],
//    iconAnchor: [20, 40]
//  });

//  var myIcon = L.divIcon({
//    iconSize: new L.Point(50, 50),
////    iconAnchor: new L.Point(50),
//    className: 'awesome-marker awesome-marker-shadow awesome-marker-icon-red',
//    html: 'foo bar'
//  });

  // adding data
  $.getJSON( "/js/cities/{{ meta.key }}.geojson", function(data) {
    L.geoJson(data, {
      pointToLayer: function (feature, latlng) {
        var markerIcon, markerOpacity = 1;
        if(feature.properties.rechtsform == 'privat') {
          markerIcon = privateSchoolMarker;
        } else {
          markerIcon = publicSchoolMarker;
        }

        return new L.marker(latlng, {
          icon: markerIcon,
          opacity: markerOpacity
        });
      },
      onEachFeature: function (feature, layer) {
        var rechtsformText, betriebText, schulformText

        if(feature.properties.rechtsform == 'privat') {
          rechtsformText = '<span class="label" style="background-color: #CF4BB7">privat</span>';
        } else {
          rechtsformText = '<span class="label" style="background-color: #2EA6DC">öffentlich</span>';
        }

        betriebText = '<span class="label label-default">' + feature.properties.schulbetrieb + '</span>';
        schulformText = '<span class="label label-warning">' + feature.properties.schulform + '</span>';

        layer.bindPopup(
          '<b>' + feature.properties.schulbezeichnung
          + '<br><br>'
          + rechtsformText + ' ' + betriebText
          + '<br><br>'
          + schulformText
          + '<br><br>'
          + 'Träger: ' + feature.properties.schultrager
          + '<br><br>'
        );
      }
    }).addTo(schoolMap);
  });
</script>